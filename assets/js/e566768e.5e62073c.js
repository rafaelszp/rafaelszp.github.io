"use strict";(self.webpackChunkrafaelszp_github_io=self.webpackChunkrafaelszp_github_io||[]).push([[4787],{7674:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>b,frontMatter:()=>a,metadata:()=>o,toc:()=>u});var r=n(4848),s=n(8453);const a={title:"Restoring Kubernetes 1.18 cluster after moving to aws",date:"2023-11-21",categories:["kubernetes","linux"]},i=void 0,o={permalink:"/blog/2023/11/21/2023/11/restoring-kubernetes-1-18-cluster-after-moving-to-aws",editUrl:"https://github.com/rafaelszp/rafaelszp.github.io/tree/master/blog/blog/2023/11/2023-11-21-restoring-kubernetes-1-18-cluster-after-moving-to-aws/index.md",source:"@site/blog/2023/11/2023-11-21-restoring-kubernetes-1-18-cluster-after-moving-to-aws/index.md",title:"Restoring Kubernetes 1.18 cluster after moving to aws",description:"Reference//devopstales.github.io/kubernetes/k8s-change-ip/",date:"2023-11-21T00:00:00.000Z",tags:[],readingTime:.455,hasTruncateMarker:!1,authors:[],frontMatter:{title:"Restoring Kubernetes 1.18 cluster after moving to aws",date:"2023-11-21",categories:["kubernetes","linux"]},unlisted:!1,prevItem:{title:"Removing dangling namespace from Kubernetes (Status: Terminating)",permalink:"/blog/2023/11/29/2023/11/removing-dangling-namespace-from-kubernetes-status-terminating"},nextItem:{title:"Checking if jar file is Valid",permalink:"/blog/2023/10/30/2023/10/checking-if-jar-file-is-valid"}},c={authorsImageUrls:[]},u=[];function l(e){const t={a:"a",code:"code",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-shell",children:'export K8S_NODE_IP=\nsystemctl disable docker kubelet\nsystemctl stop docker kubelet\n\nmv /etc/kubernetes /etc/kubernetes-backup\nmv /var/lib/kubelet /var/lib/kubelet-backup\n\nmkdir /etc/kubernetes/kubeadm -p\ncp -r /etc/kubernetes-backup/pki /etc/kubernetes\nrm -f /etc/kubernetes/pki/{apiserver.*,etcd/peer.*}\ncp /etc/kubernetes-backup/kubeadm/kubeadm-config.yaml /etc/kubernetes/kubeadm/\nrm -f ~/.kube/config\n\nsystemctl start docker\n\necho "KUBELET_EXTRA_ARGS=\\"--node-ip=$K8S_NODE_IP\\"" > /etc/sysconfig/kubelet\n\nkubeadm init --config /etc/kubernetes/kubeadm/kubeadm-config.yaml --ignore-preflight-errors=DirAvailable--var-lib-etcd\n\ncp /etc/kubernetes/admin.conf ~/.kube/config\n\nkubectl cluster-info\n\nkubectl get nodes --sort-by=.metadata.creationTimestamp\nkubectl delete node $(kubectl get node |awk \'/NotReady/ {print $1}\')\n\n\n\n\nsystemctl enable docker kubelet\n\n\n#Depois de resetar worker\nkubeadm token create --print-join-command\n\n\n\n### Worker\nyes | kubeadm reset\nexport K8S_NODE_IP=\necho "KUBELET_EXTRA_ARGS=\\"--node-ip=$K8S_NODE_IP\\"" > /etc/sysconfig/kubelet\n'})}),"\n",(0,r.jsxs)(t.p,{children:["Reference: ",(0,r.jsx)(t.a,{href:"https://devopstales.github.io/kubernetes/k8s-change-ip/",children:"https://devopstales.github.io/kubernetes/k8s-change-ip/"})]})]})}function b(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>i,x:()=>o});var r=n(6540);const s={},a=r.createContext(s);function i(e){const t=r.useContext(a);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),r.createElement(a.Provider,{value:t},e.children)}}}]);
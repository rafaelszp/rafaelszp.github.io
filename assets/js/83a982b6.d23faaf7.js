"use strict";(self.webpackChunkrafaelszp_github_io=self.webpackChunkrafaelszp_github_io||[]).push([[2060],{4193:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>d,frontMatter:()=>o,metadata:()=>l,toc:()=>i});var r=s(4848),t=s(8453);const o={title:"Kube dns from desktop via port forward",date:"2022-04-25",categories:["kubernetes"]},a=void 0,l={permalink:"/blog/2022/04/25/2022/04/kube-dns-from-desktop-via-port-forward",editUrl:"https://github.com/rafaelszp/rafaelszp.github.io/tree/master/blog/blog/2022/04/2022-04-25-kube-dns-from-desktop-via-port-forward/index.md",source:"@site/blog/2022/04/2022-04-25-kube-dns-from-desktop-via-port-forward/index.md",title:"Kube dns from desktop via port forward",description:"This is a copy, please use the original article",date:"2022-04-25T00:00:00.000Z",tags:[],readingTime:2.965,hasTruncateMarker:!1,authors:[],frontMatter:{title:"Kube dns from desktop via port forward",date:"2022-04-25",categories:["kubernetes"]},unlisted:!1,prevItem:{title:"Solving ssh prompting for password even when using RSA pub key",permalink:"/blog/2022/06/14/2022/06/solving-ssh-prompting-for-password-even-when-using-rsa-pub-key"},nextItem:{title:"Reset pacman mirror pool",permalink:"/blog/2022/03/21/2022/03/reset-pacman-mirror-pool"}},c={authorsImageUrls:[]},i=[];function u(e){const n={a:"a",code:"code",li:"li",ol:"ol",p:"p",pre:"pre",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"This is a copy, please use the original article"}),"\n",(0,r.jsxs)(n.p,{children:["Original: ",(0,r.jsx)(n.a,{href:"https://blog.kubiosec.io/accessing-kube-dns-from-your-desktop",children:"kubiosec"})]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Setup port-forwarding"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"First, we need to create a port-forwarding tunnel. kubectl port-forward currenlty does not support UDP, only TCP. We need to keep this in mind, since DNS uses UDP by default."}),"\n",(0,r.jsx)(n.p,{children:"sudo kubectl port-forward svc/kube-dns -n kube-system 53:53 &"}),"\n",(0,r.jsxs)(n.ol,{start:"2",children:["\n",(0,r.jsx)(n.li,{children:"Using NSLOOKUP"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"NSLOOKUP requires to set some sort of configuration. First we configure NSLOOKUP to use TCP with the set vc option. Secondly we point NSLOOKUP to use localhost as the new DNS server."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"$ nslookup\n> set vc\n> server 127.0.0.1\nDefault server: 127.0.0.1\nAddress: 127.0.0.1#53\n> set debug\n> set q=A\n\n> www.radarhack.com\nServer:        127.0.0.1\nAddress:    127.0.0.1#53\n\n------------\n    QUESTIONS:\n    www.radarhack.com, type = A, class = IN\n    ANSWERS:\n    ->  www.radarhack.com\n    internet address = 198.199.124.250\n    ttl = 30\n    AUTHORITY RECORDS:\n    ADDITIONAL RECORDS:\n------------\nNon-authoritative answer:\nName:    www.radarhack.com\nAddress: 198.199.124.250\n\n> www.default.svc.cluster.local\nServer:        127.0.0.1\nAddress:    127.0.0.1#53\n\n------------\n    QUESTIONS:\n    www.default.svc.cluster.local, type = A, class = IN\n    ANSWERS:\n    ->  www.default.svc.cluster.local\n    internet address = 10.105.12.40\n    ttl = 30\n    AUTHORITY RECORDS:\n    ADDITIONAL RECORDS:\n------------\nName:    www.default.svc.cluster.local\nAddress: 10.105.12.40\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"3",children:["\n",(0,r.jsx)(n.li,{children:"Using DIG"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"$ dig +tcp @127.0.0.1 www.kubiosec.io\n\n; <<>> DiG 9.10.6 <<>> +tcp @127.0.0.1 www.kubiosec.io\n; (1 server found)\n;; global options: +cmd\n;; Got answer:\n;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 60803\n;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1\n\n;; OPT PSEUDOSECTION:\n; EDNS: version: 0, flags:; udp: 4096\n;; QUESTION SECTION:\n;www.kubiosec.io.        IN    A\n\n;; ANSWER SECTION:\nwww.kubiosec.io.    30    IN    A    162.159.153.4\n\n;; Query time: 84 msec\n;; SERVER: 127.0.0.1#53(127.0.0.1)\n;; WHEN: Sat Mar 26 18:58:14 CET 2022\n;; MSG SIZE  rcvd: 75\n\ndig +tcp @127.0.0.1 kubernetes.default.svc.cluster.local\n\n; <<>> DiG 9.10.6 <<>> +tcp @127.0.0.1 kubernetes.default.svc.cluster.local\n; (1 server found)\n;; global options: +cmd\n;; Got answer:\n;; WARNING: .local is reserved for Multicast DNS\n;; You are currently testing what happens when an mDNS query is leaked to DNS\n;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 28465\n;; flags: qr aa rd; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1\n;; WARNING: recursion requested but not available\n\n;; OPT PSEUDOSECTION:\n; EDNS: version: 0, flags:; udp: 4096\n;; QUESTION SECTION:\n;kubernetes.default.svc.cluster.local. IN A\n\n;; ANSWER SECTION:\nkubernetes.default.svc.cluster.local. 30 IN A    10.96.0.1\n\n;; Query time: 13 msec\n;; SERVER: 127.0.0.1#53(127.0.0.1)\n;; WHEN: Sat Mar 26 18:59:06 CET 2022\n;; MSG SIZE  rcvd: 117\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"4",children:["\n",(0,r.jsx)(n.li,{children:"Service enumeration"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"kube-dns also support the SRV record. This record allows you to discover the services a.k.a. ports of specific services. It is also a great hacking trick to list all services in kubernetes, just by using DNS."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"$ dig +tcp @127.0.0.1 kubernetes.default.svc.cluster.local\n\n; <<>> DiG 9.10.6 <<>> +tcp @127.0.0.1 kubernetes.default.svc.cluster.local\n; (1 server found)\n;; global options: +cmd\n;; Got answer:\n;; WARNING: .local is reserved for Multicast DNS\n;; You are currently testing what happens when an mDNS query is leaked to DNS\n;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 28465\n;; flags: qr aa rd; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1\n;; WARNING: recursion requested but not available\n\n;; OPT PSEUDOSECTION:\n; EDNS: version: 0, flags:; udp: 4096\n;; QUESTION SECTION:\n;kubernetes.default.svc.cluster.local. IN A\n\n;; ANSWER SECTION:\nkubernetes.default.svc.cluster.local. 30 IN A    10.96.0.1\n\n;; Query time: 13 msec\n;; SERVER: 127.0.0.1#53(127.0.0.1)\n;; WHEN: Sat Mar 26 18:59:06 CET 2022\n;; MSG SIZE  rcvd: 117\n\n$ dig +noall +answer +tcp @127.0.0.1 srv any.any.svc.cluster.local\nany.any.svc.cluster.local. 30    IN    SRV    0 12 80 www.default.svc.cluster.local.\nany.any.svc.cluster.local. 30    IN    SRV    0 12 443 kubernetes.default.svc.cluster.local.\nany.any.svc.cluster.local. 30    IN    SRV    0 12 53 kube-dns.kube-system.svc.cluster.local.\nany.any.svc.cluster.local. 30    IN    SRV    0 12 9153 kube-dns.kube-system.svc.cluster.local.\n"})})]})}function d(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(u,{...e})}):u(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>l});var r=s(6540);const t={},o=r.createContext(t);function a(e){const n=r.useContext(o);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),r.createElement(o.Provider,{value:n},e.children)}}}]);
"use strict";(self.webpackChunkrafaelszp_github_io=self.webpackChunkrafaelszp_github_io||[]).push([[76],{7990:(e,a,s)=>{s.r(a),s.d(a,{assets:()=>d,contentTitle:()=>r,default:()=>u,frontMatter:()=>o,metadata:()=>t,toc:()=>c});var n=s(4848),i=s(8453);const o={sidebar_label:"Estudo de caso 1 - NAT Gateway"},r="AWS - Estudo de caso - NAT Gateway",t={id:"aws/Networking/Case Studies/natgateway",title:"AWS - Estudo de caso - NAT Gateway",description:"Introdu\xe7\xe3o",source:"@site/docs/aws/Networking/Case Studies/natgateway.md",sourceDirName:"aws/Networking/Case Studies",slug:"/aws/Networking/Case Studies/natgateway",permalink:"/docs/aws/Networking/Case Studies/natgateway",draft:!1,unlisted:!1,editUrl:"https://github.com/rafaelszp/rafaelszp.github.io/tree/main/packages/create-docusaurus/templates/shared/docs/aws/Networking/Case Studies/natgateway.md",tags:[],version:"current",frontMatter:{sidebar_label:"Estudo de caso 1 - NAT Gateway"},sidebar:"principal",previous:{title:"Intro",permalink:"/docs/aws/"}},d={},c=[{value:"Introdu\xe7\xe3o",id:"introdu\xe7\xe3o",level:2},{value:"Caso 1 - NAT Gateway",id:"caso-1---nat-gateway",level:2},{value:"Especifica\xe7\xf5es",id:"especifica\xe7\xf5es",level:3},{value:"Solu\xe7\xe3o adotada",id:"solu\xe7\xe3o-adotada",level:2},{value:"Outras informa\xe7\xf5es",id:"outras-informa\xe7\xf5es",level:3},{value:"Validando a solu\xe7\xe3o",id:"validando-a-solu\xe7\xe3o",level:2},{value:"Quest\xf5es a serem respondidas",id:"quest\xf5es-a-serem-respondidas",level:3},{value:"TODO",id:"todo",level:2},{value:"Refer\xeancias",id:"refer\xeancias",level:2}];function l(e){const a={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(a.h1,{id:"aws---estudo-de-caso---nat-gateway",children:"AWS - Estudo de caso - NAT Gateway"}),"\n",(0,n.jsx)(a.h2,{id:"introdu\xe7\xe3o",children:"Introdu\xe7\xe3o"}),"\n",(0,n.jsxs)(a.p,{children:["Desde abril/2024 tenho feito imers\xe3o na Cloud Provider AWS com intuito de certificar-me como Arquiteto de Solu\xe7\xf5es em um futuro n\xe3o t\xe3o distante. Para encurtar o caminho estou realizando um treinamento na CloudFaster, que possui um m\xe9todo bem interessante chamado ",(0,n.jsx)(a.a,{href:"https://cloudfaster.academy/curso/advc",children:"M\xe9todo ADVC"}),"."]}),"\n",(0,n.jsx)(a.p,{children:"Com isso comecei a me atentar para um tema que at\xe9 pouco tempo atr\xe1s gerava pouco interesse: redes, subredes e roteamento. Assim, ao adentrar neste assunto me deparei com as seguintes d\xfavidas:"}),"\n",(0,n.jsxs)(a.ul,{children:["\n",(0,n.jsx)(a.li,{children:"Como conectar duas VPCs de forma que as inst\xe2ncias e servi\xe7os possam comunicar entre si?"}),"\n",(0,n.jsx)(a.li,{children:"Para qu\xea serve o NAT Gateway? N\xe3o \xe9 a mesma coisa que o Internet Gateway?"}),"\n",(0,n.jsx)(a.li,{children:"E as rotas? Elas funcionam realmente em todas as AZ's ou somente dentro das subnets a elas associadas?"}),"\n"]}),"\n",(0,n.jsx)(a.p,{children:"Ent\xe3o, como um tecnicista com vi\xe9s que tende ao pragmatismo, resolvi elaborar dois estudos de caso, sendo um referente ao NAT Gateway e um ao Transit Gateway. Todavia, neste artigo tratarei somente do NAT Gateway."}),"\n",(0,n.jsxs)("mark",{children:[(0,n.jsx)(a.strong,{children:"Aten\xe7\xe3o"}),": Esta solu\xe7\xe3o foi elaborada com intuito de aprender como funcionam os servi\xe7os de rede da AWS, por isso ",(0,n.jsx)(a.strong,{children:"N\xc3O DEVE SER ADOTADA DE FORMA ALGUMA"})," como pr\xe1tica ou como refer\xeancia arquitetural."]}),"\n",(0,n.jsx)(a.h2,{id:"caso-1---nat-gateway",children:"Caso 1 - NAT Gateway"}),"\n",(0,n.jsx)(a.p,{children:"Neste caso, resolvi me desafiar ao definir a seguinte circunst\xe2ncia a ser tratada:  Desenvolver uma arquitetura que deve atender as seguintes especifica\xe7\xf5es a seguir."}),"\n",(0,n.jsx)(a.h3,{id:"especifica\xe7\xf5es",children:"Especifica\xe7\xf5es"}),"\n",(0,n.jsx)(a.p,{children:"Desenvolver uma arquitetura de redes, baseadas na Cloud Provider AWS, em que haja:"}),"\n",(0,n.jsxs)(a.ul,{children:["\n",(0,n.jsxs)(a.li,{children:["Duas (2) VPCs, nomeadas ",(0,n.jsx)(a.code,{children:"VPC-A"})," e ",(0,n.jsx)(a.code,{children:"VPC-B"}),", criadas de forma manualmente;"]}),"\n",(0,n.jsxs)(a.li,{children:["As VPCs devem possuir cada uma:","\n",(0,n.jsxs)(a.ul,{children:["\n",(0,n.jsx)(a.li,{children:"Uma subnet privada"}),"\n",(0,n.jsx)(a.li,{children:"Uma subnet p\xfablica"}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(a.li,{children:["Sobre a conectividade:","\n",(0,n.jsxs)(a.ul,{children:["\n",(0,n.jsxs)(a.li,{children:["As inst\xe2ncias e/ou servi\xe7os alocados nas As subnets privadas das VPCs ",(0,n.jsx)(a.code,{children:"VPC-A"})," e ",(0,n.jsx)(a.code,{children:"VPC-B"})," devem comunicar entre si"]}),"\n",(0,n.jsx)(a.li,{children:"Todo o tr\xe1fego de sa\xedda para a internet deve, obrigatoriamente, ser roteado para subnet p\xfablica de cada VPC"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(a.p,{children:"Al\xe9m destas especifica\xe7\xf5es, \xe9 importante contemplar tamb\xe9m:"}),"\n",(0,n.jsxs)(a.ol,{children:["\n",(0,n.jsx)(a.li,{children:"NAT Gateway para fazer o tr\xe1fego de sa\xedda das subnets p\xfablicas"}),"\n",(0,n.jsx)(a.li,{children:"Todas as subnets devem estar em zonas distintas"}),"\n",(0,n.jsxs)(a.li,{children:["Um teste deve ser realizado para averiguar se subnets p\xfablicas da VPC-A conseguem comunicar com os hosts de subnets privadas de VPC-B e vice-versa","\n",(0,n.jsxs)(a.ul,{children:["\n",(0,n.jsx)(a.li,{children:"Caso n\xe3o haja tr\xe1fego, deve ser determinada a solu\xe7\xe3o de contorno"}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(a.li,{children:"Um teste deve ser realizado para averiguar se \xe9 poss\xedvel acessar a internet atrav\xe9s do NAT Gateway associado \xe0 outra VPC"}),"\n",(0,n.jsx)(a.li,{children:"Um teste deve ser realizado para averiguar se os NAT Gateway prov\xea conectividade \xe0s subnets de uma mesma VPC, independente da AZ de cada subnet"}),"\n",(0,n.jsx)(a.li,{children:"Mesmo que haja um NAT Gateway, ainda \xe9 preciso configurar um Internet Gateway para possibilitar o tr\xe1fego com a Internet"}),"\n"]}),"\n",(0,n.jsx)(a.p,{children:"Para finalizar este desafio \xe9 imprescind\xedvel entender e descrever:"}),"\n",(0,n.jsxs)(a.ul,{children:["\n",(0,n.jsx)(a.li,{children:"Tabelas de rotas de cada subnet;"}),"\n",(0,n.jsx)(a.li,{children:"ENIs associadas aos servi\xe7os de conectividade com a Internet;"}),"\n",(0,n.jsx)(a.li,{children:"EIPs associados aos recursos de conectividade com a Internet;"}),"\n",(0,n.jsx)(a.li,{children:"Endere\xe7amento das VPCs;"}),"\n",(0,n.jsx)(a.li,{children:"Gateways utilizados nesta solu\xe7\xe3o;"}),"\n",(0,n.jsx)(a.li,{children:"Security groups utilizados;"}),"\n"]}),"\n",(0,n.jsx)(a.h2,{id:"solu\xe7\xe3o-adotada",children:"Solu\xe7\xe3o adotada"}),"\n",(0,n.jsx)(a.p,{children:"Para desenvolver esta solu\xe7\xe3o, me baseei em um dos labs fornecidos pelo curso M\xe9todo ADVC, que foi crucial para o entendimento e constru\xe7\xe3o da solu\xe7\xe3o. Abaixo segue o diagrama:"}),"\n",(0,n.jsx)(a.p,{children:(0,n.jsx)(a.img,{alt:"diagrama",src:s(8364).A+"",width:"2013",height:"1104"})}),"\n",(0,n.jsx)(a.h3,{id:"outras-informa\xe7\xf5es",children:"Outras informa\xe7\xf5es"}),"\n",(0,n.jsx)(a.p,{children:"Para esta solu\xe7\xe3o ressalto ainda:"}),"\n",(0,n.jsxs)(a.ul,{children:["\n",(0,n.jsxs)(a.li,{children:["Fora adotada o servi\xe7o VPC Peering, para estabelecer conectividade entre as VPCs A e B sendo:","\n",(0,n.jsxs)(a.ul,{children:["\n",(0,n.jsx)(a.li,{children:"VPC-A - requester"}),"\n",(0,n.jsx)(a.li,{children:"VPC-B - accepter"}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(a.li,{children:["Somente estabelecer o peering n\xe3o era suficiente para que a conectividade fosse poss\xedvel, para isso realizei as seguintes a\xe7\xf5es:","\n",(0,n.jsxs)(a.ul,{children:["\n",(0,n.jsx)(a.li,{children:"No console da AWS, na se\xe7\xe3o relativa ao peering, foi preciso aceitar a configura\xe7\xe3o criada;"}),"\n",(0,n.jsx)(a.li,{children:"Foi necess\xe1rio criar uma entrada em cada subnet privada, sendo que o destino era o CIDR da VPC adjacente e o target era a configura\xe7\xe3o de peering criada"}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(a.li,{children:"Para cada NAT Gateway, foi associada uma ENI (Elastic Network Interface) p\xfablica, ou seja, um EIP (Elastic IP)  foi conectado \xe0 ENI referente ao NAT Gateway;"}),"\n",(0,n.jsxs)(a.li,{children:["Dois security groups foram criados, uma vez que s\xe3o recursos de VPC:","\n",(0,n.jsxs)(a.ul,{children:["\n",(0,n.jsxs)(a.li,{children:["sgA - referente \xe0s ENIs das inst\xe2ncias EC2 associadas \xe0 subnet pvt-sub-a permitindo comunica\xe7\xe3o SSH e ICMP para o CIDR ",(0,n.jsx)(a.code,{children:"0.0.0.0/0"})]}),"\n",(0,n.jsxs)(a.li,{children:["sgB - referente \xe0s ENIs das inst\xe2ncias EC2 associadas \xe0 subnet pvt-sub-b permitindo comunica\xe7\xe3o SSH e ICMP  para o CIDR ",(0,n.jsx)(a.code,{children:"0.0.0.0/0"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(a.h2,{id:"validando-a-solu\xe7\xe3o",children:"Validando a solu\xe7\xe3o"}),"\n",(0,n.jsx)(a.p,{children:"Para validar a arquitetura proposta realizei alguns testes, sendo:"}),"\n",(0,n.jsxs)(a.ul,{children:["\n",(0,n.jsx)(a.li,{children:"Foi poss\xedvel realizar icmp(ping) em todas as instancias das subnets privadas das VPCs A e B"}),"\n",(0,n.jsx)(a.li,{children:"O NAT Gateway, conforme consta na documenta\xe7\xe3o oficial da AWS, permitiu conectividade \xe0 internet \xe0 VPC adjacente (VPC-A <> VPC-B );"}),"\n",(0,n.jsx)(a.li,{children:"O NAT Gateway possibilitou o tr\xe1fego de sa\xedda para as subnets privadas da VPC associada, desta forma \xe9 poss\xedvel utilizar o mesmo gateway para tr\xe1fego de sa\xedda, desde que seja na VPC onde fora associado e que haja rota configurada"}),"\n",(0,n.jsxs)(a.li,{children:["Na configura\xe7\xe3o do diagrama proposto, o ping (icmp) foi bem sucedido para o seguinte caso:","\n",(0,n.jsxs)(a.ul,{children:["\n",(0,n.jsxs)(a.li,{children:[(0,n.jsx)(a.strong,{children:"origem:"})," inst\xe2ncia EC2 criada na subnet pvt-sub-a1"]}),"\n",(0,n.jsxs)(a.li,{children:[(0,n.jsx)(a.strong,{children:"destino:"})," inst\xe2ncia EC2 criada na subnet pvt-sub-b1"]}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(a.li,{children:["Na configura\xe7\xe3o da solu\xe7\xe3o proposta, n\xe3o foi poss\xedvel pingar fazer ping de:","\n",(0,n.jsxs)(a.ul,{children:["\n",(0,n.jsxs)(a.li,{children:[(0,n.jsx)(a.strong,{children:"origem:"})," inst\xe2ncia EC2 associada \xe0 subnet pub-sub-a1"]}),"\n",(0,n.jsxs)(a.li,{children:[(0,n.jsx)(a.strong,{children:"destino:"})," inst\xe2ncia EC2 associada \xe0 subnet pvt-sub-b1"]}),"\n",(0,n.jsxs)(a.li,{children:["Para que a comunica\xe7\xe3o fosse estabelecida, foi preciso:","\n",(0,n.jsxs)(a.ul,{children:["\n",(0,n.jsxs)(a.li,{children:["Criar uma entrada na rota ",(0,n.jsx)(a.code,{children:"pub-sub-a"})," com destino  ao CIDR ",(0,n.jsx)(a.code,{children:"10.1.0.0/16"})," (VPC-B)  al\xe9m de definir o peering  (pcx-abc) como target(alvo)"]}),"\n",(0,n.jsxs)(a.li,{children:["N\xe3o foi necess\xe1rio acrescentar entrada na ",(0,n.jsx)(a.code,{children:"pvt-sub-b"})," apontando para o CIDR da VPC-A, por\xe9m acredito que seja uma boa pr\xe1tica acrescentar esta entrada;"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(a.h3,{id:"quest\xf5es-a-serem-respondidas",children:"Quest\xf5es a serem respondidas"}),"\n",(0,n.jsxs)(a.ul,{children:["\n",(0,n.jsxs)(a.li,{children:["Na documenta\xe7\xe3o \xe9 mencionado o NGW Privado para fazer conex\xe3o entre VPC's, mas como fazer essa conex\xe3o? Ser\xe1 via Transit Gateway, se sim como deve ser feito isso??","\n",(0,n.jsxs)(a.ul,{children:["\n",(0,n.jsx)(a.li,{children:"Como tentativa, criei um NAT Gateway privado e rotas associadas a ele, mas n\xe3o obtive sucesso."}),"\n",(0,n.jsx)(a.li,{children:"Ao tentar associar uma ENI avulsa ao NGW Privado, n\xe3o era poss\xedvel pois n\xe3o este recurso n\xe3o era listado"}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(a.li,{children:"E se precisar conectar uma VPN (Site to Site). Qual servi\xe7o seria utilizado para isso? Um Virtual Private Gateway? Como seria a tabela de roteamento entre a VPC e a rede On Premises?"}),"\n"]}),"\n",(0,n.jsx)(a.h2,{id:"todo",children:"TODO"}),"\n",(0,n.jsx)(a.p,{children:"Toda a configura\xe7\xe3o foi utilizada por meio da pr\xe1tica ClickOps, que n\xe3o \xe9 recomendada, assim o pr\xf3ximo desafio \xe9 escrever um IaC que represente esta arquitetura proposta. Al\xe9m disto, \xe9 importante validar no Well Architected se as pr\xe1ticas desta solu\xe7\xe3o s\xe3o adequadas."}),"\n",(0,n.jsx)(a.h2,{id:"refer\xeancias",children:"Refer\xeancias"}),"\n",(0,n.jsxs)(a.ol,{children:["\n",(0,n.jsx)(a.li,{children:(0,n.jsx)(a.a,{href:"https://docs.aws.amazon.com/vpc/latest/userguide/nat-gateway-scenarios.html",children:"https://docs.aws.amazon.com/vpc/latest/userguide/nat-gateway-scenarios.html"})}),"\n"]})]})}function u(e={}){const{wrapper:a}={...(0,i.R)(),...e.components};return a?(0,n.jsx)(a,{...e,children:(0,n.jsx)(l,{...e})}):l(e)}},8364:(e,a,s)=>{s.d(a,{A:()=>n});const n=s.p+"assets/images/AWS - Estudo de caso - NAT Gateway - estendido-8c2f4f5f3b72642f3b1f61ca1e86e52e.png"},8453:(e,a,s)=>{s.d(a,{R:()=>r,x:()=>t});var n=s(6540);const i={},o=n.createContext(i);function r(e){const a=n.useContext(o);return n.useMemo((function(){return"function"==typeof e?e(a):{...a,...e}}),[a,e])}function t(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),n.createElement(o.Provider,{value:a},e.children)}}}]);
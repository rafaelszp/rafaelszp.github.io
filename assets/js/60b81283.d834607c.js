"use strict";(self.webpackChunkrafaelszp_github_io=self.webpackChunkrafaelszp_github_io||[]).push([[6185],{2233:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>l,contentTitle:()=>s,default:()=>p,frontMatter:()=>o,metadata:()=>a,toc:()=>d});var t=i(4848),r=i(8453);const o={title:"Fixing missing EFI partition after pacman upgrade",date:"2017-12-15",categories:["arch-linux","linux"]},s=void 0,a={permalink:"/blog/2017/12/15/2017/12/fixing-missing-efi-partition-after-pacman-upgrade",editUrl:"https://github.com/rafaelszp/rafaelszp.github.io/tree/master/blog/blog/2017/12/2017-12-15-fixing-missing-efi-partition-after-pacman-upgrade/index.md",source:"@site/blog/2017/12/2017-12-15-fixing-missing-efi-partition-after-pacman-upgrade/index.md",title:"Fixing missing EFI partition after pacman upgrade",description:"Sometimes when we do",date:"2017-12-15T00:00:00.000Z",tags:[],readingTime:.935,hasTruncateMarker:!1,authors:[],frontMatter:{title:"Fixing missing EFI partition after pacman upgrade",date:"2017-12-15",categories:["arch-linux","linux"]},unlisted:!1,prevItem:{title:"Download files from Google Drive using WGET",permalink:"/blog/2018/02/06/2018/02/download-files-from-google-drive-using-wget"},nextItem:{title:"Improving ArchLinux fonts",permalink:"/blog/2017/12/15/2017/12/improving-archlinux-fonts"}},l={authorsImageUrls:[]},d=[{value:"Bonus",id:"bonus",level:4}];function c(n){const e={code:"code",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",...(0,r.R)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.p,{children:"Sometimes when we do"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"pacman -Syyu\n"})}),"\n",(0,t.jsx)(e.p,{children:"The installation will crash complaining about missing EFI partition. In order to fix, follow this steps:"}),"\n",(0,t.jsxs)(e.ol,{children:["\n",(0,t.jsxs)(e.li,{children:["\n",(0,t.jsx)(e.p,{children:"Boot with flash USB or DVD"}),"\n"]}),"\n",(0,t.jsxs)(e.li,{children:["\n",(0,t.jsx)(e.p,{children:"Setup keys and network"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:'loadkeys br-abnt2\n#example 10.11.21.134/16\nip addr del CURR_IP/CURR_MASK dev DEVICE \nip addr add NEWIP/NEW_MASK dev DEVICE\nip route add default NEW_IP via DEVICE\necho "nameserver 8.8.8.8" >> /etc/resolv.conf\n\n'})}),"\n"]}),"\n",(0,t.jsxs)(e.li,{children:["\n",(0,t.jsx)(e.p,{children:"Setup / and /boot (assuming / = /dev/sda2 and /boot = /dev/sda1)"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"mount /dev/sda2 /mnt\nmount /dev/sda1 /boot\n\n"})}),"\n"]}),"\n",(0,t.jsxs)(e.li,{children:["\n",(0,t.jsx)(e.p,{children:"Setup initramfs"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"arch-chroot /mnt\npacman -S filesystem linux --noconfirm\nmkinitcpio -p linux\n\n"})}),"\n"]}),"\n",(0,t.jsxs)(e.li,{children:["\n",(0,t.jsx)(e.p,{children:"Setup loader.conf"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"cat <<EOF > /boot/loader/loader.conf\ntimeout 2\ndefault arch\nEOF\n\n"})}),"\n",(0,t.jsx)(e.p,{children:"Setup arch.conf"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"cat <<EOF > /boot/loader/entries/arch.conf\ntitle Arch Linux\nlinux /vmlinuz-linux\ninitrd /initramfs-linux.img\noptions root=/dev/sda2 rw\nEOF\n\n"})}),"\n"]}),"\n",(0,t.jsxs)(e.li,{children:["\n",(0,t.jsx)(e.p,{children:"Setup grub"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"#if using custom install\ngrub-install --target=x86_64-efi --efi-directory=/boot --bootloader-id=grub --recheck\ngrub-mkconfig -o /boot/grub/grub.cfg\nexit \n\n"})}),"\n"]}),"\n",(0,t.jsxs)(e.li,{children:["\n",(0,t.jsx)(e.p,{children:"Rebooting"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"umount /mnt/boot\numount /mnt\nreboot\n\n"})}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(e.h4,{id:"bonus",children:"Bonus"}),"\n",(0,t.jsx)(e.p,{children:"In case you have formatted boot partition you need to reinstall base and base-dev like following(Outside arch-chroot):"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"pacstrap -i base base-devel\n\n"})})]})}function p(n={}){const{wrapper:e}={...(0,r.R)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(c,{...n})}):c(n)}},8453:(n,e,i)=>{i.d(e,{R:()=>s,x:()=>a});var t=i(6540);const r={},o=t.createContext(r);function s(n){const e=t.useContext(o);return t.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function a(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:s(n.components),t.createElement(o.Provider,{value:e},n.children)}}}]);
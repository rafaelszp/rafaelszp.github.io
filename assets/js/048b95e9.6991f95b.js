"use strict";(self.webpackChunkrafaelszp_github_io=self.webpackChunkrafaelszp_github_io||[]).push([[1173],{1767:(e,a,s)=>{s.r(a),s.d(a,{assets:()=>d,contentTitle:()=>i,default:()=>u,frontMatter:()=>r,metadata:()=>t,toc:()=>c});var n=s(4848),o=s(8453);const r={sidebar_label:"ECS Fargate Container Deployment"},i="ECS Fargate Container Deployment",t={id:"aws/Computing/Articles/ECS Fargate Deployment",title:"ECS Fargate Container Deployment",description:"Created56",source:"@site/docs/aws/Computing/Articles/ECS Fargate Deployment.md",sourceDirName:"aws/Computing/Articles",slug:"/aws/Computing/Articles/ECS Fargate Deployment",permalink:"/docs/aws/Computing/Articles/ECS Fargate Deployment",draft:!1,unlisted:!1,editUrl:"https://github.com/rafaelszp/rafaelszp.github.io/tree/main/packages/create-docusaurus/templates/shared/docs/aws/Computing/Articles/ECS Fargate Deployment.md",tags:[],version:"current",frontMatter:{sidebar_label:"ECS Fargate Container Deployment"},sidebar:"principal",previous:{title:"Intro",permalink:"/docs/aws/"},next:{title:"Estudo de caso 1 - NAT Gateway",permalink:"/docs/aws/Networking/Case Studies/natgateway"}},d={},c=[{value:"O que \xe9 ECS",id:"o-que-\xe9-ecs",level:2},{value:"ECS: Task Definition",id:"ecs-task-definition",level:3},{value:"ECS: Launch Types (LT)",id:"ecs-launch-types-lt",level:3},{value:"ECS - LT: EC2",id:"ecs---lt-ec2",level:4},{value:"ECS - LT: Fargate",id:"ecs---lt-fargate",level:4},{value:"Estados na Lifecycle",id:"estados-na-lifecycle",level:4},{value:"Execu\xe7\xe3o on demand",id:"execu\xe7\xe3o-on-demand",level:4},{value:"ECS: Uso do ECR",id:"ecs-uso-do-ecr",level:3},{value:"ECS: Detalhes ao executar uma aplica\xe7\xe3o no ECS Fargate",id:"ecs-detalhes-ao-executar-uma-aplica\xe7\xe3o-no-ecs-fargate",level:2}];function l(e){const a={a:"a",h1:"h1",h2:"h2",h3:"h3",h4:"h4",hr:"hr",img:"img",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(a.h1,{id:"ecs-fargate-container-deployment",children:"ECS Fargate Container Deployment"}),"\n",(0,n.jsx)(a.p,{children:"Created: 2024-05-21 06:56\r\nTags: #aws #ecs #devops"}),"\n",(0,n.jsx)(a.h2,{id:"o-que-\xe9-ecs",children:"O que \xe9 ECS"}),"\n",(0,n.jsx)(a.p,{children:"\xc9 o servi\xe7o de orquestra\xe7\xe3o de cont\xeainers da AWS que utiliza um componente chave para execu\xe7\xe3o de aplica\xe7\xf5es: Docker.\r\nAs principais caracter\xedsticas deste servi\xe7o s\xe3o:"}),"\n",(0,n.jsxs)(a.ul,{children:["\n",(0,n.jsx)(a.li,{children:'Premissa de n\xe3o se preocupar com a infraestrutura ao executar aplica\xe7\xf5es no [AWS Fargate](AWS Fargate "wikilink")'}),"\n",(0,n.jsx)(a.li,{children:'Totalmente integrado ao [IAM](03 - Contas, acessos e IAM "wikilink")'}),"\n",(0,n.jsx)(a.li,{children:"Integrado ao Cloudwatch para integra\xe7\xe3o com uso de m\xe9tricas, logs e monitoramento"}),"\n",(0,n.jsx)(a.li,{children:'O modelo de deployment que utiliza o [AWS Fargate](AWS Fargate "wikilink") \xe9 o que \xe9 realmente considerado Cloud Native\r\n### Termos chave'}),"\n",(0,n.jsx)(a.li,{children:"Tasks"}),"\n",(0,n.jsx)(a.li,{children:"Task Definitions"}),"\n",(0,n.jsx)(a.li,{children:"Services"}),"\n",(0,n.jsx)(a.li,{children:"Clusters\r\n## ECS: Conceitos"}),"\n"]}),"\n",(0,n.jsx)(a.h3,{id:"ecs-task-definition",children:"ECS: Task Definition"}),"\n",(0,n.jsx)(a.p,{children:"\xc9 o blueprint (planta, plano de execu\xe7\xe3o) para execu\xe7\xe3o das Tasks.\r\nEm rela\xe7\xe3o \xe0s propriedades da Task Definition:"}),"\n",(0,n.jsxs)(a.ul,{children:["\n",(0,n.jsxs)(a.li,{children:[(0,n.jsx)(a.strong,{children:"Launch type"}),", tipo de servi\xe7o que ser\xe1 utilizado para executar o cont\xeaineres: EC2, Fargate ou External"]}),"\n",(0,n.jsxs)(a.li,{children:[(0,n.jsx)(a.strong,{children:"Roles"}),", necess\xe1rios 2 roles principais para execu\xe7\xe3o:"]}),"\n",(0,n.jsxs)(a.li,{children:[(0,n.jsx)(a.strong,{children:"Task Definition roles"}),", com permiss\xf5es requeridas para execu\xe7\xe3o de cont\xeainers em uma task, por exemplo: pull de imagens no ECR, injetar segredos do SecretsManager"]}),"\n",(0,n.jsxs)(a.li,{children:[(0,n.jsx)(a.strong,{children:"Task roles"}),", que s\xe3o atribu\xeddas \xe0 task em si, utilizadas em runtime, ou seja, durante execu\xe7\xe3o dos cont\xeainers, por exemplo: query no DynamoDB, acessar um arquivo no S3, montar EFS, enviar mensagens ao SQS"]}),"\n",(0,n.jsxs)(a.li,{children:[(0,n.jsx)(a.strong,{children:"Container image"}),", URL da imagem docker a ser executada, ex.: URL do ECR"]}),"\n",(0,n.jsxs)(a.li,{children:[(0,n.jsx)(a.strong,{children:"vCPU e mem\xf3ria alocados"}),', quanto de recurso ser\xe1 necess\xe1rio para executar uma task. Vale destacar que se houver necessidade de maior processamento, o tipo LaunchType EC2 \xe9 mais apropriado, o Fargate deve ser utilizado para uso "mais modesto" de recursos o quando n\xe3o \xe9 poss\xedvel predeterminar os valores de aloca\xe7\xe3o']}),"\n",(0,n.jsxs)(a.li,{children:[(0,n.jsx)(a.strong,{children:"Vari\xe1veis de ambiente"}),", vari\xe1veis de ambientes que ser\xe3o utilizadas nos cont\xeaineres associados \xe0 task"]}),"\n",(0,n.jsxs)(a.li,{children:[(0,n.jsx)(a.strong,{children:"Secrets"}),", \xe9 poss\xedvel injetar dados sens\xedveis a partir do AWS Secrets Manager ou do Systems Manager Parameter Store"]}),"\n",(0,n.jsxs)(a.li,{children:[(0,n.jsx)(a.strong,{children:"Logging configuration"}),' Defini\xe7\xe3o do "log driver"']}),"\n",(0,n.jsx)(a.li,{children:"Fargate: awslogs, splunk e awsfirelens"}),"\n",(0,n.jsx)(a.li,{children:"ECS: fluentd, json-file"}),"\n",(0,n.jsxs)(a.li,{children:[(0,n.jsx)(a.strong,{children:"Exposed ports"}),": Quais as portas que o cont\xeainer utiliza para tr\xe1fego de entrada\r\n## ECS: Task"]}),"\n"]}),"\n",(0,n.jsxs)(a.p,{children:["Uma task \xe9 a execu\xe7\xe3o baseada nas defini\xe7\xf5es, \xe9 composta de um conjunto de cont\xeaineres executados no mesmo host. A defini\xe7\xe3o \xe9 no formato Docker Compose.\r\nEx.:\r\n",(0,n.jsx)(a.img,{alt:"Pasted image 20240521093327.png",src:s(7083).A+"",title:"wikilink",width:"767",height:"415"})]}),"\n",(0,n.jsx)(a.p,{children:'Al\xe9m disto, \xe9 poss\xedvel executar a Task de diretamente(manualmente), que permanecer\xe1 ativa at\xe9 que seja manualmente finalizada ou que finalize por si mesma. Neste tipo de execu\xe7\xe3o, n\xe3o haver\xe1 reposi\xe7\xe3o (replacement).\r\n### ECS: Service\r\nUm gerenciador de ciclo de vida de Tasks, lembra um pouco o Deployment do K8s. Possui health check e reposi\xe7\xe3o de inst\xe2ncias "n\xe3o saud\xe1veis"\r\n### ECS: Clusters\r\n\xc9 um agrupamento de Services e Tasks, lembra o namespace do K8s.'}),"\n",(0,n.jsx)(a.h3,{id:"ecs-launch-types-lt",children:"ECS: Launch Types (LT)"}),"\n",(0,n.jsx)(a.p,{children:"S\xe3o 3 tipos de Launch Types, ou seja, Workloads: EC2, Fargate e External"}),"\n",(0,n.jsx)(a.h4,{id:"ecs---lt-ec2",children:"ECS - LT: EC2"}),"\n",(0,n.jsx)(a.p,{children:"Onde o usu\xe1rio deve controlar a infraestrutura da Task, como volumes, CPU, Aloca\xe7\xe3o, SO, Security groups, etc. Recomend\xe1vel para workloads que precisem de alto processamento"}),"\n",(0,n.jsx)(a.h4,{id:"ecs---lt-fargate",children:"ECS - LT: Fargate"}),"\n",(0,n.jsx)(a.p,{children:'Recomend\xe1vel para Tasks que possuem baixo processamento e que tenha um range menor de elasticidade. Tamb\xe9m \xe9 recomend\xe1vel quando n\xe3o \xe9 sabida a quantidade de recursos necess\xe1rios para o workload. Low Overhead(custo adicional de recursos - hw, sw, rede, security) e bursts ocasionais.\r\n![ECS FARGATE.excalidraw.svg](ECS FARGATE.excalidraw.svg "wikilink")\r\n#### LT: External\r\nEste caso \xe9 para rodar os workload OnPremises, mas com a orquestra\xe7\xe3o do ECS.\r\n### ECS: Task Scheduling\r\n\xc9 o processo de associar as tasks a cont\xeaineres dentro de um cluster, determinando quais inst\xe2ncias de cont\xeainer s\xe3o apropriadas para execut\xe1-las.'}),"\n",(0,n.jsx)(a.h4,{id:"estados-na-lifecycle",children:"Estados na Lifecycle"}),"\n",(0,n.jsx)(a.p,{children:'![ECS - Task States lifecycle.excalidraw.svg](ECS - Task States lifecycle.excalidraw.svg "wikilink")\r\nDescrevendo o ciclo de vida, ent\xe3o:'}),"\n",(0,n.jsxs)(a.ul,{children:["\n",(0,n.jsxs)(a.li,{children:[(0,n.jsx)(a.strong,{children:"Provisioning"}),": Progresso de pr\xe9-condi\xe7\xf5es, aloca\xe7\xf5es de recurso da AWS. Ex.: anexando ENI"]}),"\n",(0,n.jsxs)(a.li,{children:[(0,n.jsx)(a.strong,{children:"Pending:"})," Aguardando disponibilidade de recursos"]}),"\n",(0,n.jsxs)(a.li,{children:[(0,n.jsx)(a.strong,{children:"Activating:"})," Executando \xfaltimas etapas/passos antes de partir para status de Running (acredito que o health check fica aqui, init-containers tamb\xe9m). Ex.: Registrando nos target groups do ALB"]}),"\n",(0,n.jsxs)(a.li,{children:[(0,n.jsx)(a.strong,{children:"Running:"})," A task est\xe1 em execu\xe7\xe3o"]}),"\n",(0,n.jsxs)(a.li,{children:[(0,n.jsx)(a.strong,{children:"Deactivating"}),": Executando passos antes de parar, por exemplo: desalocar os target groups no ALB"]}),"\n",(0,n.jsxs)(a.li,{children:[(0,n.jsx)(a.strong,{children:"Stopping"}),": Finalizando com ",(0,n.jsx)(a.strong,{children:"SIGTERM"}),", se 'estourar' o timeout(graceful time) o cont\xeainer receber\xe1 um ",(0,n.jsx)(a.strong,{children:"SIGKILL"})]}),"\n",(0,n.jsxs)(a.li,{children:[(0,n.jsx)(a.strong,{children:"Deprovisioning"}),": Passos finais para transi\xe7\xe3o para o estado de ",(0,n.jsx)(a.strong,{children:"Stopped"}),", ex: desalocando ENI"]}),"\n",(0,n.jsxs)(a.li,{children:[(0,n.jsx)(a.strong,{children:"Stopped"}),': Task foi finalizada com sucesso\r\n#### EventBrigde e agendamento regular\r\nO agendamento das tarefas baseado em hor\xe1rios regulares \xe9 executada pelo servi\xe7o [Event Bridge](O que \xe9 event bridge "wikilink"). \xc9 importante que este servi\xe7o possua permiss\xf5es para executar as tasks nos tempos pr\xe9-determinados.']}),"\n"]}),"\n",(0,n.jsx)(a.h4,{id:"execu\xe7\xe3o-on-demand",children:"Execu\xe7\xe3o on demand"}),"\n",(0,n.jsxs)(a.p,{children:["\xc9 a modalidade onde executamos as Tasks de forma standalone, sem um service scheduler. Ideal para quando precisamos fazer algum teste da Task ou quando \xe9 uma execu\xe7\xe3o muito pontual.\r\n",(0,n.jsx)(a.strong,{children:"Ponto importante"})," Dependendo do modo de rede, \xe9 preciso fornecer detalhes da VPC desejada."]}),"\n",(0,n.jsx)(a.h3,{id:"ecs-uso-do-ecr",children:"ECS: Uso do ECR"}),"\n",(0,n.jsxs)(a.p,{children:["O tipo Fargate depende das imagens de cont\xeainer, por um registro de imagens, por\xe9m, o mais indicado seria utilizar o ECR, devido ao baixo custo e alta integra\xe7\xe3o(nativa) com o Fargate.\r\n",(0,n.jsx)(a.strong,{children:"Ponto importante"})," O Fargate n\xe3o gera custos de download de imagens quando usando o ECR, pois o tr\xe1fego n\xe3o passa pela internet, mas pela rede interna da AWS. Outro detalhe \xe9 que a cobran\xe7a do ECR \xe9 basicamente por armazenamento e por tr\xe1fego para Internet."]}),"\n",(0,n.jsx)(a.hr,{}),"\n",(0,n.jsx)(a.h2,{id:"ecs-detalhes-ao-executar-uma-aplica\xe7\xe3o-no-ecs-fargate",children:"ECS: Detalhes ao executar uma aplica\xe7\xe3o no ECS Fargate"}),"\n",(0,n.jsx)(a.p,{children:'![ECS - Esquema b\xe1sico de uma aplica\xe7\xe3o NodeJS com Fargate .excalidraw.svg](ECS - Esquema b\xe1sico de uma aplica\xe7\xe3o NodeJS com Fargate .excalidraw.svg "wikilink")\r\n## References'}),"\n",(0,n.jsxs)(a.ol,{children:["\n",(0,n.jsx)(a.li,{children:"AWS Fundamentals - Running and Orchestrating Containers with ECS Fargate p\xe1gina 85 (ebook)"}),"\n",(0,n.jsxs)(a.li,{children:["Deploy applications on Amazon ECS using Docker Compose ",(0,n.jsx)(a.a,{href:"https://aws.amazon.com/blogs/containers/deploy-applications-on-amazon-ecs-using-docker-compose/",children:"https://aws.amazon.com/blogs/containers/deploy-applications-on-amazon-ecs-using-docker-compose/"})]}),"\n",(0,n.jsxs)(a.li,{children:["Deploy applications on Amazon ECS using Docker Compose ",(0,n.jsx)(a.a,{href:"https://www.docker.com/blog/docker-compose-from-local-to-amazon-ecs/",children:"https://www.docker.com/blog/docker-compose-from-local-to-amazon-ecs/"})]}),"\n"]})]})}function u(e={}){const{wrapper:a}={...(0,o.R)(),...e.components};return a?(0,n.jsx)(a,{...e,children:(0,n.jsx)(l,{...e})}):l(e)}},7083:(e,a,s)=>{s.d(a,{A:()=>n});const n=s.p+"assets/images/7d00f780b3fdd7f31b3d44386bd67c230535c1bf-d12ee866f858e1bfbde0c5f8454c1b26.png"},8453:(e,a,s)=>{s.d(a,{R:()=>i,x:()=>t});var n=s(6540);const o={},r=n.createContext(o);function i(e){const a=n.useContext(r);return n.useMemo((function(){return"function"==typeof e?e(a):{...a,...e}}),[a,e])}function t(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),n.createElement(r.Provider,{value:a},e.children)}}}]);
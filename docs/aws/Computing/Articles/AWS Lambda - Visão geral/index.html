<!doctype html>
<html lang="pt-BR" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-aws/Computing/Articles/AWS Lambda - Visão geral" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.3.2">
<title data-rh="true">AWS Lambda - Visão geral | Rafael&#x27; Case studies</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://rafaelszp.github.io/img/rafaelszp.jpg"><meta data-rh="true" name="twitter:image" content="https://rafaelszp.github.io/img/rafaelszp.jpg"><meta data-rh="true" property="og:url" content="https://rafaelszp.github.io/docs/aws/Computing/Articles/AWS Lambda - Visão geral"><meta data-rh="true" property="og:locale" content="pt_BR"><meta data-rh="true" name="docusaurus_locale" content="pt-BR"><meta data-rh="true" name="docsearch:language" content="pt-BR"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="AWS Lambda - Visão geral | Rafael&#x27; Case studies"><meta data-rh="true" name="description" content="Created04"><meta data-rh="true" property="og:description" content="Created04"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://rafaelszp.github.io/docs/aws/Computing/Articles/AWS Lambda - Visão geral"><link data-rh="true" rel="alternate" href="https://rafaelszp.github.io/docs/aws/Computing/Articles/AWS Lambda - Visão geral" hreflang="pt-BR"><link data-rh="true" rel="alternate" href="https://rafaelszp.github.io/docs/aws/Computing/Articles/AWS Lambda - Visão geral" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://BVVE68SDSY-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Rafael&#39; Case studies RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Rafael&#39; Case studies Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="Rafael&#39; Case studies" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.cda026f6.css">
<script src="/assets/js/runtime~main.732a438e.js" defer="defer"></script>
<script src="/assets/js/main.ec3adad7.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Pular para o conteúdo principal"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Pular para o conteúdo principal</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Alternar a barra de navegação" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/rafaelszp.jpg" alt="Rafael&#x27;s Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/rafaelszp.jpg" alt="Rafael&#x27;s Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Rafael SZP</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Estudos</a><a class="navbar__item navbar__link" href="/blog">Snippets</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/rafaelszp" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Meu GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Alterar entre os modos claro e escuro (modo modo claro ativado)" aria-label="Alterar entre os modos claro e escuro (modo modo claro ativado)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Buscar"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Buscar</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Volte para o topo" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/">Intro</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/aws/References/">AWS</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/aws/References/">References</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/aws/">Intro</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/docs/aws/Computing/Articles/AWS Lambda - Visão geral">Computing</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/docs/aws/Computing/Articles/AWS Lambda - Visão geral">Articles</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/aws/Computing/Articles/AWS Lambda - Visão geral">AWS Lambda - Visão geral</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/aws/Computing/Articles/ECS Fargate Deployment">ECS Fargate Container Deployment</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/aws/DevOps/articles/Code Pipeline - Visão geral">DevOps</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/aws/Networking/Articles/AWS Cloudfront - Visão geral">Networking</a></div></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Página Inicial" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">AWS</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Computing</span><meta itemprop="position" content="2"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Articles</span><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">AWS Lambda - Visão geral</span><meta itemprop="position" content="4"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">Nessa página</button></div><div class="theme-doc-markdown markdown"><h1>AWS Lambda - Visão geral</h1>
<p>Created: 2024-05-29 07:04</p>
<p>Tags: <code>#aws</code> <code>#servless</code> <code>#lambda</code></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="o-que-é">O que é?<a href="#o-que-é" class="hash-link" aria-label="Link direto para O que é?" title="Link direto para O que é?">​</a></h2>
<p>Segundo a documentação da fabricante <em>&quot;O AWS Lambda é um serviço de computação que permite executar código sem o provisionamento ou gerenciamento de servidores.&quot;</em> Basicamente, o intuito desta Cloud Provider é fornecer um serviço que reduz as &quot;preocupações&quot; dos clientes somente com o código da rotina que desejam executar, pois o provisionamento de infraestrutura, servidores, configurações e toda a parafernália necessária fica abstraída para &quot;longe das vistas&quot; do cliente.</p>
<p>É importante ressaltar que mesmo que seja categorizado como servless, não significa que não há servidores e infraestrutura por traz deste serviço. O que esse termo &quot;servless&quot; traz consigo é o conceito de &quot;foque no que precisa fazer&quot;, a estrutura necessária fica cargo da AWS.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="como-funciona">Como funciona?<a href="#como-funciona" class="hash-link" aria-label="Link direto para Como funciona?" title="Link direto para Como funciona?">​</a></h2>
<p>O serviço é executado em microcontêineres, assim a cada requisição ou evento para uma determinada função Lambda, é iniciado o microcontêiner correspondente que irá responder por aquela requisição. Estes microcontêineres são reaproveitados desde que não estejam desalocados e estejam ociosos.</p>
<p>Quando um microcontêiner é iniciado pela primeira vez e inicializado ele passa por um processo chamado <strong>Cold Start</strong> que é basicamente condensado nos seguintes passos:</p>
<p><img decoding="async" loading="lazy" alt="100%" src="/assets/images/AWS Lambda Coldstart.excalidraw-e125b62f14b5dcb9eb0af31bc605d3bc.svg" width="712" height="180" class="img_ev3q"></p>
<p>Um importante aspecto a considerar que o Cold Start precisa de um tempo para ser concluído, isto significa que as primeiras requisições levarão mais tempo para concluir. Para termos uma idéia, devido ao processo de inicialização, as 5% requisições mais lentas do Lambda são mais lentas que o serviço AWS Fargate.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="detalhes-internos">Detalhes internos<a href="#detalhes-internos" class="hash-link" aria-label="Link direto para Detalhes internos" title="Link direto para Detalhes internos">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="uso-de-microcontêineres">Uso de microcontêineres<a href="#uso-de-microcontêineres" class="hash-link" aria-label="Link direto para Uso de microcontêineres" title="Link direto para Uso de microcontêineres">​</a></h3>
<p>Os microntêineres executam somente uma função por vez, para que suporte mais requisições, mais ambientes devem ser criados para que haja paralelismo, isto significa que haverá <strong>Cold start</strong> para cada contêiner que responsável por responder às requisições.</p>
<p>Basicamente, as funções são executadas a partir do código escrito na função <code>handler</code>, sendo possível utilizar o <strong>global scope</strong>, desta forma outras execuções do mesmo microcontêiner podem se aproveitar das variáveis, constantes e funções que lá forem declaradas. Ainda sobre o <strong>global scope</strong>, é importante ressaltar que ele utiliza muitos recursos de CPU e memória, além disto os primeiros 10s de execução neste escopo não são cobrados.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="iam">IAM<a href="#iam" class="hash-link" aria-label="Link direto para IAM" title="Link direto para IAM">​</a></h3>
<p>Durante a execução, as funções as lambda functions utilizam uma Execution Role para acessarem serviços serviços e recursos da AWS, como por exemplo enviar trace data para o AWS X-Ray. Desta forma as funções Lambda irão <strong>assumir</strong> este role, de modo que não é preciso chamar o <code>sts:AssumeRole</code> manualmente dentro da função, pois a AWS faz isso automaticamente.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="autenticidade-do-código">Autenticidade do código<a href="#autenticidade-do-código" class="hash-link" aria-label="Link direto para Autenticidade do código" title="Link direto para Autenticidade do código">​</a></h3>
<p>No quesito segurança da informação, é possível utilizar o serviço AWS Signer para garantir a autenticidade do código mediante uso de um <em>Signing profile</em> apropriado. Basicamente são utilizados 2 buckets S3, sendo um para armazenar os objetos que serão assinados e outro bucket para guardar os objetos assinados, assim o AWS Signer utilizará um <em>signing job</em> para capturar os objetos não assinados, assiná-los e guardar no bucket apropriado.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="múltiplas-versões-em-paralelo">Múltiplas versões em paralelo<a href="#múltiplas-versões-em-paralelo" class="hash-link" aria-label="Link direto para Múltiplas versões em paralelo" title="Link direto para Múltiplas versões em paralelo">​</a></h2>
<p>Uma funcionalidade importante das Lambda Functions é que é possível manter várias versões da mesma função sendo executadas em paralelo, de modo que podemos manter a compatibilidade com aplicações que utilizam versões mais antigas das funções.</p>
<p>Para utilizar esta estratégia, podemos referenciar as funções das seguintes formas:</p>
<ul>
<li>Pelo ARN da função, que mantêm nos últimos blocos a referência da revisão utilizada</li>
<li>Por meio de aliases/apelidos da função, deixando revisão com caráter mais mnemônico.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="uso-de-vpc">Uso de VPC<a href="#uso-de-vpc" class="hash-link" aria-label="Link direto para Uso de VPC" title="Link direto para Uso de VPC">​</a></h2>
<p>Existem serviços que residem dentro de uma VPC e só podem ser acessados por recursos que estiverem alocados nela, por isso, caso seja necessário comunicar com algum destes desses serviços através de funções Lambda, devemos associá-las às VPCs ondem residem esses recursos.</p>
<p>Associar as funções à VPC implica maiores custos, por exemplo:</p>
<ul>
<li>Haverá custo de transferência de dados entre as lambdas e os serviços acessados;</li>
<li>Haverá custo de storage;</li>
<li>Haverá maior custo referente ao ColdStart;</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="variáveis-de-ambiente">Variáveis de ambiente<a href="#variáveis-de-ambiente" class="hash-link" aria-label="Link direto para Variáveis de ambiente" title="Link direto para Variáveis de ambiente">​</a></h2>
<p>As funções Lambda utilizam variáveis de ambiente durante sua execução, de modo que dentro do código da função é possível executar as rotinas padrão da runtime escolhida para ler os valores das variáveis de ambiente, por exemplo:</p>
<table><thead><tr><th>Runtime</th><th>Rotina</th></tr></thead><tbody><tr><td>Java</td><td><code>System.getenv()</code></td></tr><tr><td>Python</td><td><code>os.environ</code></td></tr><tr><td>NodeJS</td><td><code>process.env</code></td></tr></tbody></table>
<p>Durante a execução das funções lambda, são injetadas variáveis padrão da AWS, como: <code>AWS_REGION</code>, <code>X_AMZN_TRACE_ID</code> e <code>AWS_LAMBDA_FUNCION_VERSION</code></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="modos-de-invocação">Modos de invocação<a href="#modos-de-invocação" class="hash-link" aria-label="Link direto para Modos de invocação" title="Link direto para Modos de invocação">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="sincronicidade">Sincronicidade<a href="#sincronicidade" class="hash-link" aria-label="Link direto para Sincronicidade" title="Link direto para Sincronicidade">​</a></h3>
<p>As funções Lambda podem ser invocadas das seguintes formas:</p>
<ul>
<li><code>InvocationType: Event</code>, ou seja, de modo assíncrono. Isto significa que retornam imediatamente uma resposta, bem ao estilo <em>Fire and Forget</em></li>
<li><code>InvocationType: RequestResponse</code>, ou seja síncrono, no modelo RPC, em que esperada umas resposta após o término do processamento.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="meios-de-invocação">Meios de invocação<a href="#meios-de-invocação" class="hash-link" aria-label="Link direto para Meios de invocação" title="Link direto para Meios de invocação">​</a></h3>
<p>É possível realizar a invocação de funções lambda por vários meios a saber:</p>
<ul>
<li>EventBrige, através de regra de agendamento periódico</li>
<li>API Gateway</li>
<li>Outras funções lambda via AWS SDK</li>
<li>Aplicações, via AWS SDK</li>
<li>Chamadas de API</li>
<li>AWS CLI</li>
<li>SQS Queue</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="controlando-falhas-de-funções-assíncronas">Controlando falhas de funções assíncronas<a href="#controlando-falhas-de-funções-assíncronas" class="hash-link" aria-label="Link direto para Controlando falhas de funções assíncronas" title="Link direto para Controlando falhas de funções assíncronas">​</a></h3>
<p>Caso uma invocação assíncrona de função falhe ou que expire sem que haja processamento, é possível realizar as seguintes ações:</p>
<ol>
<li>Utilizar o mecanismo padrão de on-failure destination (SNS Queue, SNS Topic, EventBridge, outra função Lambda)</li>
<li>Configurar uma Dead-letter-queue (DLQ) para registrar esses eventos e ter um maior controle como gerenciar as falhas, levando em conta que as SQS Queues tem tempo de vida, mesmo as DLQs.</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="plataformas-e-arquiteturas-suportadas">Plataformas e arquiteturas suportadas<a href="#plataformas-e-arquiteturas-suportadas" class="hash-link" aria-label="Link direto para Plataformas e arquiteturas suportadas" title="Link direto para Plataformas e arquiteturas suportadas">​</a></h2>
<p>Nativamente as funções AWS Lambda suportam as seguintes plataformas de desenvolvimento (até a presente data):</p>
<ul>
<li>NodeJS, 20, 18, 16</li>
<li>Python: 3.8-12</li>
<li>Java: 21,17,11,8</li>
<li>.Net: 6-8</li>
<li>Ruby: 3.2 e 3.3</li>
</ul>
<p>Caso seja preciso utilizar outras plataformas de progração, como Rust ou Go, é necessário providenciar uma runtime para executar as funções Lambda, em formato de arquivo zip.</p>
<p>Em relação às arquiteturas suportadas, até o presente momento, temos:</p>
<ul>
<li>x86_64, baseada em processadores x86</li>
<li>arm64, baseada no processador AWS Graviton2</li>
</ul>
<p>Também é possível provisionar runtimes de outras plataformas de programação em formato de imagens Docker.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="garantindo-capacidades-e-diminuindo-o-cold-start">Garantindo capacidades e diminuindo o cold start<a href="#garantindo-capacidades-e-diminuindo-o-cold-start" class="hash-link" aria-label="Link direto para Garantindo capacidades e diminuindo o cold start" title="Link direto para Garantindo capacidades e diminuindo o cold start">​</a></h2>
<p>Para diminuir o impacto do cold start, referente ao tempo de resposta aumentado em consequência do bootstrap da função, podemos utilizar as seguintes estratégias:</p>
<ul>
<li>Utilizar o <strong>Reserved Concurrency</strong>, em que indica o número máximo de execuções paralelas para uma função específica. A definição deste parâmetro consome o limite de funções em execução por região;</li>
<li>Utilizar o <strong>provisioned concurrency</strong>, que são instâncias pré-inicializadas e já prontas para responder as requisições rapidamente.</li>
<li>Realizar, periodicamente, health checks estratégicos por meio de EventBridge Scheduling rules, desta forma teremos &quot;quase sempre&quot; instâncias ativas, levando em conta que em algum momento, mesmo com esta estratégia, as instâncias serão desprovisionadas automaticamente pela AWS</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="cold-start-na-plataforma-java">Cold Start na plataforma Java<a href="#cold-start-na-plataforma-java" class="hash-link" aria-label="Link direto para Cold Start na plataforma Java" title="Link direto para Cold Start na plataforma Java">​</a></h3>
<p>O cold start na plataforma Java é consideravelmente maior do que nas plataformas baseadas em script como NodeJs e Python. Por isso, ao considerar esta plataforma devemos considerar o uso do <strong>SnapStart</strong> para melhorar o tempo de inicialização em até 10x, além disto, o uso de provisioned concurrency também deve ser considerado.</p>
<p>Para que o tempo de cold start seja diminuído, o SnapStart &quot;tira&quot; um snapshot da memória e do estado do disco, aprimorando o tempo de boot em até 10 vezes.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="uso-de-layers-para-dependências">Uso de Layers para dependências<a href="#uso-de-layers-para-dependências" class="hash-link" aria-label="Link direto para Uso de Layers para dependências" title="Link direto para Uso de Layers para dependências">​</a></h2>
<p>Para um uso mais efetivo das lambda functions, diminuindo os tempos de packaging e de cold start, é importante utilizar Layers para armazenar as dependências da aplicação. São basicamente arquivos zip que são carregados na configuração das lambda functions.</p>
<p>É importante frisar que os pacotes de dependências devem estar nas pastas corretas, por exemplo o NodeJS precisa que o <code>node_modules</code> esteja na pasta <code>nodejs</code>, localizada na raiz do projeto.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="uso-de-storage-externo">Uso de storage externo<a href="#uso-de-storage-externo" class="hash-link" aria-label="Link direto para Uso de storage externo" title="Link direto para Uso de storage externo">​</a></h2>
<p>É possível utilizar serviços de storage da AWS nas modalidades EFS e S3. Sendo que para o EFS, devemos considerar:</p>
<ul>
<li>Haverá custo de tráfego entre o lambda e o EFS</li>
<li>É preciso associar uma lambda à VPC, pois o EFS é regional</li>
<li>Haverá custo de throughput</li>
<li>Haverá custo de armazenamento no EFS</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="limites">Limites<a href="#limites" class="hash-link" aria-label="Link direto para Limites" title="Link direto para Limites">​</a></h2>
<p>Existem limites nas Lambda Functions que devem ser observados:</p>
<ul>
<li>Tamanho máximo de uma função, contemplando Layers e projeto: 50mb para arquivos zipados e 250mb decompactado;</li>
<li>Tempo máximo de execução de uma função: 15min. Este limite não é ajustável</li>
<li>Limite de funções operando concorrentemente: 1000 para contas antigas</li>
<li>Storage para funções: 75GB por região</li>
<li>Uma função pode usar entre 128mb e 10204mb de RAM. Este limite não é ajustável</li>
<li>Uma função pode ter, no máximo 5 layers. Este limite não é ajustável</li>
<li>Payload máximo assíncrono: 256Kb</li>
<li>Payload máximo síncrono: 6mb</li>
</ul>
<p>Os limites acima são os mais relevantes, porém é recomendável observar todos os limites na <a href="https://docs.aws.amazon.com/lambda/latest/dg/gettingstarted-limits.html" target="_blank" rel="noopener noreferrer">documentação oficial</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="monitoramento">Monitoramento<a href="#monitoramento" class="hash-link" aria-label="Link direto para Monitoramento" title="Link direto para Monitoramento">​</a></h2>
<p>O monitoramento das execuções das funções lambda pode ser realizado pelo AWS Cloudwatch de forma que podemos monitorar as seguintes métricas:</p>
<ul>
<li><strong>Invocations</strong>, numero de invocações</li>
<li><strong>Duration</strong>, tempo de processamento (avg, min, max)</li>
<li><strong>Error count</strong> e <strong>success rate(%)</strong></li>
<li><strong>Throttles</strong> - Número de falhas devido a problemas de limites de concorrência</li>
<li><strong>IteratorAge</strong>, para stream event sources, a idade do último item no batch quando o Lambda o recebeu e invocou a função</li>
<li><strong>Async delivery failure</strong>s, número de erros ao tentar gravar no destino ou na DLQ</li>
<li><strong>Concurrent executions</strong>, numero de instâncias que estão processando eventos</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="custo">Custo<a href="#custo" class="hash-link" aria-label="Link direto para Custo" title="Link direto para Custo">​</a></h2>
<p>A cobrança das funções lambda é baseada nos seguintes parâmetros:</p>
<ul>
<li>Memória configurada</li>
<li>Tempo de execução</li>
<li>Uso de storage temporário (ephemeral storage)</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="pontos-a-observar-e-práticas-recomendadas">Pontos a observar e práticas recomendadas<a href="#pontos-a-observar-e-práticas-recomendadas" class="hash-link" aria-label="Link direto para Pontos a observar e práticas recomendadas" title="Link direto para Pontos a observar e práticas recomendadas">​</a></h2>
<p>Sobre o uso de lambda há alguns pontos que devemos nos atentar como:</p>
<ul>
<li>Ao usar DLQs, atente-se para o TTL dos eventos lá registrados para eventos importantes não sejam perdidos</li>
<li>Os primeiros 10s de processamento do <em>global scope</em> não é cobrado, então é boa prática utilizá-lo para diminuir custos de operação</li>
<li>Regularmente, invoque health-checks estratégicos, para diminuir o impacto dos cold starts</li>
<li>Mesmo com health-checks estratégicos, as instâncias são desprovisionadas automaticamente pela AWS</li>
<li>Caso seja imperativo manter um tempo de resposta baixo, utilize a estratégia de <strong>preserved concurrency</strong></li>
<li>O uso e preserved concurrency acarreta:</li>
<li>Maior tempo de deployment</li>
<li>Maior custo</li>
<li>Quanto maior a memória definida para a função lambda, maior será o custo financeiro atrelado ao aumento de recursos de de processamento e de memória</li>
<li>Sempre considere o tempo máximo de execução de uma função, que é de 15 minutos e não é ajustável</li>
<li>Funções assíncronas não tem retorno imediato de falha, é preciso utilizar os mecanismos apropriados para monitorar os erros</li>
<li>Para invocar outras funções lambda a permissão <code>lambda:InvokeFuncion</code> é requerida na execution role da função</li>
<li>Atente-se para o timeout correto esperado da função, ajustando o valor apropriado para não incorrer em erros de timeout</li>
<li>É possível publicar uma função direto na Internet, sem uso de um API Gateway, por meio de uma URL de acesso</li>
<li>O acesso direto pela Internet deve vir junto com a configuração de <em>Authentication type</em> para <code>node</code>, para que o IAM não negue o acesso</li>
<li>Caso precisemos dimunir a latência é possível utilizar o serviço Lambda@Edge integrado ao CloudFront</li>
<li>O Lambda@Edge não possui todas as funcionalidades, então é preciso arquitetar bem o uso desta característica</li>
<li>Existe proteção de recursão, para evitar loops infinitos e consequentemente custos não esperados. Este recurso é parametrizável e habilitado por padrão, sendo que o limite padrão de recursão é 16, suportando outros serviços como SQS e SNS</li>
<li>Caso não haja nenhum microcontêiner ocioso, ocorrerá cold start de novas instâncias, aumentando o tempo da requisição</li>
<li>Até o presente momento o SnapStart <strong>Não está</strong> disponível para arm64</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="considerações-pessoais-sobre-o-uso">Considerações pessoais sobre o uso<a href="#considerações-pessoais-sobre-o-uso" class="hash-link" aria-label="Link direto para Considerações pessoais sobre o uso" title="Link direto para Considerações pessoais sobre o uso">​</a></h2>
<p>Basicamente, Lambda deve ser utilizada para processamentos rápidos, de baixo tthroughput, baixo grau de paralelismo e nenhum acoplamento. Acredito que os melhores usos são para:</p>
<ul>
<li>Transformações rápidas</li>
<li>encaminhamento de processamento</li>
<li>encarregado de &quot;saber&quot; para quem entregar (orquestrador)</li>
<li>Descarregar DLQs</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="referências">Referências<a href="#referências" class="hash-link" aria-label="Link direto para Referências" title="Link direto para Referências">​</a></h2>
<ol>
<li><a href="https://docs.aws.amazon.com/pt_br/lambda/latest/dg/welcome.html" target="_blank" rel="noopener noreferrer">https://docs.aws.amazon.com/pt_br/lambda/latest/dg/welcome.html</a></li>
<li><a href="https://docs.aws.amazon.com/lambda/latest/dg/runtimes-custom.html" target="_blank" rel="noopener noreferrer">https://docs.aws.amazon.com/lambda/latest/dg/runtimes-custom.html</a></li>
<li><a href="https://docs.aws.amazon.com/pt_br/lambda/latest/dg/images-create.html" target="_blank" rel="noopener noreferrer">https://docs.aws.amazon.com/pt_br/lambda/latest/dg/images-create.html</a></li>
<li><a href="https://docs.aws.amazon.com/lambda/latest/dg/snapstart.html" target="_blank" rel="noopener noreferrer">https://docs.aws.amazon.com/lambda/latest/dg/snapstart.html</a></li>
<li><a href="https://docs.aws.amazon.com/lambda/latest/dg/lambda-intro-execution-role.html" target="_blank" rel="noopener noreferrer">https://docs.aws.amazon.com/lambda/latest/dg/lambda-intro-execution-role.html</a></li>
<li><a href="https://docs.aws.amazon.com/eventbridge/latest/userguide/eb-run-lambda-schedule.html" target="_blank" rel="noopener noreferrer">https://docs.aws.amazon.com/eventbridge/latest/userguide/eb-run-lambda-schedule.html</a></li>
<li><a href="https://docs.aws.amazon.com/lambda/latest/dg/services-apigateway.html" target="_blank" rel="noopener noreferrer">https://docs.aws.amazon.com/lambda/latest/dg/services-apigateway.html</a></li>
<li><a href="https://docs.aws.amazon.com/lambda/latest/dg/example_lambda_Invoke_section.html" target="_blank" rel="noopener noreferrer">https://docs.aws.amazon.com/lambda/latest/dg/example_lambda_Invoke_section.html</a></li>
<li><a href="https://docs.aws.amazon.com/lambda/latest/dg/with-sqs.html" target="_blank" rel="noopener noreferrer">https://docs.aws.amazon.com/lambda/latest/dg/with-sqs.html</a></li>
<li><a href="https://aws.amazon.com/blogs/compute/implementing-aws-lambda-error-handling-patterns/" target="_blank" rel="noopener noreferrer">https://aws.amazon.com/blogs/compute/implementing-aws-lambda-error-handling-patterns/</a></li>
<li><a href="https://docs.aws.amazon.com/signer/latest/developerguide/lambda-workflow.html" target="_blank" rel="noopener noreferrer">https://docs.aws.amazon.com/signer/latest/developerguide/lambda-workflow.html</a></li>
<li><a href="https://docs.aws.amazon.com/lambda/latest/dg/lambda-concurrency.html" target="_blank" rel="noopener noreferrer">https://docs.aws.amazon.com/lambda/latest/dg/lambda-concurrency.html</a></li>
<li><a href="https://docs.aws.amazon.com/lambda/latest/dg/gettingstarted-limits.html" target="_blank" rel="noopener noreferrer">https://docs.aws.amazon.com/lambda/latest/dg/gettingstarted-limits.html</a></li>
</ol></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/rafaelszp/rafaelszp.github.io/tree/main/packages/create-docusaurus/templates/shared/docs/aws/Computing/Articles/AWS Lambda - Visão geral.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Editar essa página</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Páginas de documentação"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/aws/"><div class="pagination-nav__sublabel">Anterior</div><div class="pagination-nav__label">Intro</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/aws/Computing/Articles/ECS Fargate Deployment"><div class="pagination-nav__sublabel">Próxima</div><div class="pagination-nav__label">ECS Fargate Container Deployment</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#o-que-é" class="table-of-contents__link toc-highlight">O que é?</a></li><li><a href="#como-funciona" class="table-of-contents__link toc-highlight">Como funciona?</a></li><li><a href="#detalhes-internos" class="table-of-contents__link toc-highlight">Detalhes internos</a><ul><li><a href="#uso-de-microcontêineres" class="table-of-contents__link toc-highlight">Uso de microcontêineres</a></li><li><a href="#iam" class="table-of-contents__link toc-highlight">IAM</a></li><li><a href="#autenticidade-do-código" class="table-of-contents__link toc-highlight">Autenticidade do código</a></li></ul></li><li><a href="#múltiplas-versões-em-paralelo" class="table-of-contents__link toc-highlight">Múltiplas versões em paralelo</a></li><li><a href="#uso-de-vpc" class="table-of-contents__link toc-highlight">Uso de VPC</a></li><li><a href="#variáveis-de-ambiente" class="table-of-contents__link toc-highlight">Variáveis de ambiente</a></li><li><a href="#modos-de-invocação" class="table-of-contents__link toc-highlight">Modos de invocação</a><ul><li><a href="#sincronicidade" class="table-of-contents__link toc-highlight">Sincronicidade</a></li><li><a href="#meios-de-invocação" class="table-of-contents__link toc-highlight">Meios de invocação</a></li><li><a href="#controlando-falhas-de-funções-assíncronas" class="table-of-contents__link toc-highlight">Controlando falhas de funções assíncronas</a></li></ul></li><li><a href="#plataformas-e-arquiteturas-suportadas" class="table-of-contents__link toc-highlight">Plataformas e arquiteturas suportadas</a></li><li><a href="#garantindo-capacidades-e-diminuindo-o-cold-start" class="table-of-contents__link toc-highlight">Garantindo capacidades e diminuindo o cold start</a><ul><li><a href="#cold-start-na-plataforma-java" class="table-of-contents__link toc-highlight">Cold Start na plataforma Java</a></li></ul></li><li><a href="#uso-de-layers-para-dependências" class="table-of-contents__link toc-highlight">Uso de Layers para dependências</a></li><li><a href="#uso-de-storage-externo" class="table-of-contents__link toc-highlight">Uso de storage externo</a></li><li><a href="#limites" class="table-of-contents__link toc-highlight">Limites</a></li><li><a href="#monitoramento" class="table-of-contents__link toc-highlight">Monitoramento</a></li><li><a href="#custo" class="table-of-contents__link toc-highlight">Custo</a></li><li><a href="#pontos-a-observar-e-práticas-recomendadas" class="table-of-contents__link toc-highlight">Pontos a observar e práticas recomendadas</a></li><li><a href="#considerações-pessoais-sobre-o-uso" class="table-of-contents__link toc-highlight">Considerações pessoais sobre o uso</a></li><li><a href="#referências" class="table-of-contents__link toc-highlight">Referências</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs">Studies</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://rafaelszp.wordpress.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">My Legacy Wordpress Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/szp_rafael" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://br.linkedin.com/in/rafaelszp" target="_blank" rel="noopener noreferrer" class="footer__link-item">Linked In<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Snippets</a></li><li class="footer__item"><a href="https://github.com/rafaelszp/rafaelszp.github.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Rafael Pereira, Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>